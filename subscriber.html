<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subscriber Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <div class="logo">Face Animation</div>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="#" class="active">Subscriber Dashboard</a></li>
    <li><a href="login.html">Logout</a></li>
  </ul>
</div>

<section class="user-dashboard">
<div class="dashboard-container">
  <h2>Welcome, Subscriber</h2>
  <p>Manage your avatars, animations, subscription, and premium features all in one place.</p>

  <!-- Profile Section -->
  <div class="profile-card">
    <h3>üë§ Subscriber Profile</h3>
    <p><strong>Username:</strong> <span id="username">JohnDoe</span></p>
    <p><strong>Email:</strong> <span id="email">johndoe@email.com</span></p>
    <p><strong>Subscription:</strong> Premium</p>
    <div class="profile-actions">
      <button class="btn small-btn" id="editProfileBtn">Edit Profile</button>
      <button class="btn small-btn danger-btn" id="deleteAccountBtn">Delete Account</button>
      <button class="btn small-btn danger-btn" id="logoutBtn">Logout</button>
    </div>
    <div id="editProfileForm" style="display:none; margin-top:10px;">
      <input type="text" id="newUsername" placeholder="New Username">
      <input type="email" id="newEmail" placeholder="New Email">
      <button class="btn small-btn" id="saveProfileBtn">Save</button>
      <button class="btn small-btn" id="cancelEditBtn">Cancel</button>
    </div>
  </div>

  <!-- Avatar Management -->
  <div class="avatar-management">
    <h3>üñºÔ∏è Manage Avatars</h3>
    <form class="upload-form">
      <input type="file" id="avatarUpload" accept="image/*">
      <button type="button" class="btn small-btn" id="uploadAvatarBtn">Upload Avatar</button>
    </form>
    <div class="avatar-library">
      <h4>Your Avatars</h4>
      <div class="avatar-list" id="avatarList"></div>
    </div>
  </div>

  <!-- Animation Generation Step 1 -->
  <div class="animation-generator">
    <h3>üé¨ Step 1: Choose Expression & Avatar</h3>
    <label for="expressionSelect">Choose Expression:</label>
    <select id="expressionSelect">
      <option value="">--Select Expression--</option>
      <option value="smile">üòä Smile</option>
      <option value="angry">üò° Angry</option>
      <option value="surprised">üò≤ Surprised</option>
      <option value="sad">üò¢ Sad</option>
    </select>
    <label for="avatarSelectStep1">Select Avatar:</label>
    <select id="avatarSelectStep1">
      <option value="">--Select Avatar--</option>
    </select>
    <button type="button" class="btn small-btn" id="prepareStep1Btn">Prepare Animation</button>

    <div class="animation-preview" id="step1Preview" style="display:none; margin-top:10px;">
      <h4>Preview Animation</h4>
      <video id="previewStep1Video" controls style="max-width:300px;"></video>
      <div class="profile-actions">
        <button class="btn small-btn" id="saveStep1Btn">Save Animation</button>
        <button class="btn small-btn" id="downloadStep1Btn">Download MP4</button>
        <button class="btn small-btn danger-btn" id="cancelStep1PreviewBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Animation Generation Step 2 -->
  <div class="animation-generator">
    <h3>Upload Image + Driving Video</h3>

    <label>Select Avatar:</label>
    <select id="sourceAvatarSelect">
      <option value="">--Select Avatar--</option>
    </select>

    <label>Upload Driving Video:</label>
    <input type="file" id="drivingVideoUpload" accept="video/mp4">
    <video id="videoPreview" style="display:none; max-width:300px;" controls></video>
    <button class="btn small-btn" id="generateBtn">Generate Animation</button>

    <div class="animation-preview" id="animationPreview" style="display:none; margin-top:10px;">
      <h4>Preview Animation</h4>
      <video id="previewVideoGenerated" controls style="max-width:300px;"></video>
      <div class="profile-actions">
        <button class="btn small-btn" id="saveAnimationBtn">Save Animation</button>
        <button class="btn small-btn" id="downloadAnimationBtn">Download MP4</button>
        <button class="btn small-btn danger-btn" id="cancelPreviewBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Animation History -->
  <div class="animation-history">
    <h3>üìÇ My Animations</h3>
    <div class="animation-list" id="animationList"></div>
  </div>

  <!-- Subscription Management -->
  <div class="subscription-management">
    <h3>üí≥ Subscription & Payment</h3>
    <p><strong>Status:</strong> Active Premium</p>
    <p><strong>Benefits:</strong> Unlimited animations, MP4 download, MakeItTalk audio</p>
    <form class="subscription-form">
      <label for="planSelect">Modify Plan:</label>
      <select id="planSelect">
        <option value="monthly">Monthly - $9.99</option>
        <option value="yearly">Yearly - $99.99</option>
      </select>
      <label for="paymentMethod">Update Payment Method:</label>
      <input type="text" id="paymentMethod" placeholder="Card Number">
      <button type="button" class="btn small-btn" id="updateSubscriptionBtn">Update Subscription</button>
      <button type="button" class="btn small-btn danger-btn" id="cancelSubscriptionBtn">Cancel Subscription</button>
    </form>
  </div>

</div>
</section>

<div class="footer">
  <p>&copy; 2025 Face Animation. All Rights Reserved.</p>
</div>

<script>
// --- Profile ---
const editProfileBtn = document.getElementById('editProfileBtn');
const editProfileForm = document.getElementById('editProfileForm');
const cancelEditBtn = document.getElementById('cancelEditBtn');
const saveProfileBtn = document.getElementById('saveProfileBtn');
const deleteAccountBtn = document.getElementById('deleteAccountBtn');
const logoutBtn = document.getElementById('logoutBtn');

editProfileBtn.onclick = () => editProfileForm.style.display = 'block';
cancelEditBtn.onclick = () => editProfileForm.style.display = 'none';
saveProfileBtn.onclick = () => {
  const newUsername = document.getElementById('newUsername').value;
  const newEmail = document.getElementById('newEmail').value;
  if(newUsername) document.getElementById('username').innerText = newUsername;
  if(newEmail) document.getElementById('email').innerText = newEmail;
  editProfileForm.style.display = 'none';
  alert('Profile updated!');
};
deleteAccountBtn.onclick = () => alert('Account deleted!');
logoutBtn.onclick = () => alert('Logging out...');

// --- Avatar Management ---
const avatarUpload = document.getElementById('avatarUpload');
const avatarList = document.getElementById('avatarList');
const avatarSelectStep1 = document.getElementById('avatarSelectStep1');
const sourceAvatarSelect = document.getElementById('sourceAvatarSelect');

document.getElementById('uploadAvatarBtn').onclick = () => {
  const file = avatarUpload.files[0];
  if(!file) return alert('Please choose an avatar image.');
  const reader = new FileReader();
  reader.onload = (e) => {
    const avatarDiv = document.createElement('div');
    avatarDiv.className = 'avatar-item';
    avatarDiv.innerHTML = `<img src="${e.target.result}" alt="avatar" style="max-width:100px;">
                           <button class="btn small-btn danger-btn deleteAvatarBtn">Delete</button>`;
    avatarList.appendChild(avatarDiv);

    // Add to selects
    [avatarSelectStep1, sourceAvatarSelect].forEach(select => {
      const option = document.createElement('option');
      option.value = e.target.result;
      option.textContent = file.name;
      select.add(option);
    });

    avatarDiv.querySelector('.deleteAvatarBtn').onclick = () => {
      avatarDiv.remove();
      [avatarSelectStep1, sourceAvatarSelect].forEach(select => {
        for(let i=0;i<select.options.length;i++){
          if(select.options[i].value===e.target.result) select.remove(i);
        }
      });
    };
  };
  reader.readAsDataURL(file);
  avatarUpload.value = '';
};

// --- Step 1 Animation ---
const prepareStep1Btn = document.getElementById('prepareStep1Btn');
const step1Preview = document.getElementById('step1Preview');
const previewStep1Video = document.getElementById('previewStep1Video');
const saveStep1Btn = document.getElementById('saveStep1Btn');
const downloadStep1Btn = document.getElementById('downloadStep1Btn');
const cancelStep1PreviewBtn = document.getElementById('cancelStep1PreviewBtn');
const animationList = document.getElementById('animationList');

prepareStep1Btn.onclick = () => {
  const expression = document.getElementById('expressionSelect').value;
  const avatar = avatarSelectStep1.value;
  if(!expression || !avatar) return alert('Please select expression and avatar.');
  previewStep1Video.src = avatar; // placeholder for real animation
  step1Preview.style.display = 'block';
};

saveStep1Btn.onclick = () => {
  const div = document.createElement('div');
  div.className = 'animation-item';
  div.innerHTML = `<video src="${previewStep1Video.src}" controls style="max-width:300px;"></video>
                   <button class="btn small-btn danger-btn deleteAnimationBtn">Delete</button>
                   <button class="btn small-btn" onclick="downloadFile('${previewStep1Video.src}', 'animation_step1.mp4')">Download</button>`;
  animationList.appendChild(div);
  div.querySelector('.deleteAnimationBtn').onclick = () => div.remove();
  step1Preview.style.display = 'none';
};

downloadStep1Btn.onclick = () => downloadFile(previewStep1Video.src, 'animation_step1.mp4');

cancelStep1PreviewBtn.onclick = () => {
  step1Preview.style.display = 'none';
  previewStep1Video.src = '';
};

// --- Step 2 Animation ---
const drivingVideoUpload = document.getElementById('drivingVideoUpload');
const videoPreview = document.getElementById('videoPreview');
const generateBtn = document.getElementById('generateBtn');
const animationPreview = document.getElementById('animationPreview');
const previewVideoGenerated = document.getElementById('previewVideoGenerated');

drivingVideoUpload.onchange = () => {
  if(drivingVideoUpload.files.length){
    videoPreview.src = URL.createObjectURL(drivingVideoUpload.files[0]);
    videoPreview.style.display = 'block';
  }
};

generateBtn.onclick = () => {
  const avatar = sourceAvatarSelect.value;
  if (!avatar) return alert('Please select an avatar.');
  if (!drivingVideoUpload.files.length) return alert('Please upload a driving video.');

  previewVideoGenerated.src = URL.createObjectURL(drivingVideoUpload.files[0]); // placeholder
  animationPreview.style.display = 'block';
};

document.getElementById('saveAnimationBtn').onclick = () => {
  const div = document.createElement('div');
  div.className = 'animation-item';
  div.innerHTML = `<video src="${previewVideoGenerated.src}" controls style="max-width:300px;"></video>
                   <button class="btn small-btn danger-btn deleteAnimationBtn">Delete</button>
                   <button class="btn small-btn" onclick="downloadFile('${previewVideoGenerated.src}', 'animation.mp4')">Download</button>`;
  animationList.appendChild(div);
  div.querySelector('.deleteAnimationBtn').onclick = () => div.remove();
  animationPreview.style.display = 'none';
};

document.getElementById('downloadAnimationBtn').onclick = () => downloadFile(previewVideoGenerated.src, 'animation.mp4');

document.getElementById('cancelPreviewBtn').onclick = () => {
  animationPreview.style.display = 'none';
  previewVideoGenerated.src = '';
};

// --- Subscription ---
document.getElementById('updateSubscriptionBtn').onclick = () => alert('Subscription updated!');
document.getElementById('cancelSubscriptionBtn').onclick = () => alert('Subscription cancelled!');

// --- Download Helper ---
function downloadFile(url, filename) {
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
}
</script>
</body>
</html>
